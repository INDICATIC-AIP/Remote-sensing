<!DOCTYPE html>
<html lang="en">

<head>
  <title>NOAA Nighttime Lights Panama</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="noaa.css" />
  <link rel="stylesheet" href="https://unpkg.com/nprogress@0.2.0/nprogress.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
  <script src="../noaa_renderer.js"></script>
</head>

<body>
  <div id="map-container">
    <div class="header">
      <h2>Nighttime Lights in Panama (NOAA DMSP-OLS and VIIRS)</h2>
    </div>

    <div class="controls">
      <div class="control-group">
        <!-- <label for="year">Year:</label>
        <select id="year"></select> -->
        <label for="fecha">Date:</label>
        <select id="fecha"></select>

      </div>

      <div class="control-group">
        <label for="opacidad">Opacity:</label>
        <input type="range" id="opacidad" name="opacidad" min="0" max="1" step="0.1" value="0.85"
          style="width: 120px;" />
      </div>

      <div class="button-group">
        <!-- exportarImagenes() -->
        <button onclick="abrirModalExportar()" class="primary-button">
          Export All
        </button>
        <!-- <button onclick="verificarNuevas()" class="secondary-button">
          Check for New
        </button> -->
        <button id="btn-regenerar-tiles" style="display:none;" onclick="generarTiles()" class="warning-button">
          Regenerate Tiles
        </button>
        <button onclick="abrirModalTareas()" class="secondary-button">
          NOAA Tasks
        </button>
      </div>
    </div>

    <div id="estado" class="status-message info" style="display: none;"></div>

    <div id="progreso-lanzado" class="status-message info" style="display: none;"></div>
    <div id="progreso-real" class="status-message info" style="display: none;"></div>

    <div id="map"></div>
    <div id="info"></div>
  </div>

  <button class="toggle-sidebar" id="toggle-sidebar">></button>

  <div id="sidebar">
    <div id="sidebar-header">
      <h3>Exported images</h3>
    </div>

    <div id="sidebar-content">
      <div class="filter-bar" style="flex-direction: column; gap: 15px;">
        <!-- Main button to load from Drive -->
        <button onclick="cargarImagenesLocales()" class="primary-button">
          Load local images
        </button>

        <!-- Filters that apply only after loading -->
        <div class="control-group">
          <label for="filtro-año">Filter by year:</label>
          <input type="number" id="filtro-año" placeholder="Ex: 2022" style="width: 100px;" />
        </div>

        <div class="control-group">
          <label for="filtro-tipo">Filter by type:</label>
          <select id="filtro-tipo">
            <option value="">All</option>
            <option value="DMSP">DMSP</option>
            <option value="VIIRS">VIIRS</option>
          </select>
        </div>

        <div class="control-group">
          <!--<label>Automatic verification:</label>
           <div class="checkbox-group">
            <input type="checkbox" id="auto-check" />
            <label for="auto-check">Enable automatic verification</label>
          </div> -->
          <div class="schedule-controls" style="display: none;">
            <select id="check-frequency">
              <option value="HOURLY">Hourly</option>
              <option value="DAILY">Daily</option>
              <option value="WEEKLY">Weekly</option>
            </select>
            <input type="time" id="check-time" />
            <button onclick="configurarVerificacionAutomatica()" class="secondary-button">
              Configure
            </button>
          </div>
        </div>
      </div>



      <!-- Images appear here -->
      <div id="imagenes-drive">
        <div class="status-message">Loading images...</div>
      </div>
    </div>
  </div>

  <div id="progreso-alerta" style="
  position: fixed;
  top: 20px;
  right: 20px;
  background: rgba(0,0,0,0.8);
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  z-index: 9999;
  display: none;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
"></div>

  <div id="modal-exportar" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <h3>Pending images to export</h3>

      <div style="margin-bottom: 10px;">
        <label for="filtro-dataset">Filter by dataset:</label>
        <select id="filtro-dataset" onchange="filtrarPorDataset()">
          <option value="">All</option>
          <option value="DMSP">DMSP</option>
          <option value="VIIRS">VIIRS</option>
        </select>
      </div>

      <div id="resumen-total" style="margin-bottom: 10px;"></div>

      <div id="lista-pendientes">
        <p>Loading images...</p>
      </div>

      <div class="pagination-controls" style="margin-top: 10px; display: flex; justify-content: space-between;">
        <button id="prev-pag" class="secondary-button">← Previous</button>
        <span id="pagina-actual"></span>
        <button id="next-pag" class="secondary-button">Next →</button>
      </div>

      <div style="margin-top: 15px; display: flex; justify-content: space-between;">
        <button onclick="cerrarModalExportar()" class="secondary-button">Cancel</button>
        <button onclick="confirmarExportar()" class="primary-button">Export All</button>
      </div>
    </div>
  </div>



</body>
<div id="modal-tareas" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>Scheduled NOAA tasks</h3>

    <form id="form-noaa-tarea" class="modal-body" onsubmit="guardarTareaNoaa(); return false;">
      <h4>New / Edit task</h4>
      <button type="button" onclick="cerrarModalTareas()" class="secondary-button">✖ Close</button>

      <label>Time:</label>
      <input type="time" id="modal-hora" required />

      <label>Frequency:</label>
      <select id="modal-frecuencia" required>
        <option value="ONCE">Once</option>
        <option value="DAILY">Daily</option>
        <option value="HOURLY">Hourly</option>
        <option value="WEEKLY">Weekly</option>
      </select>

      <label>Interval:</label>
      <input type="number" id="modal-intervalo" min="1" value="1" required />

      <div style="margin-top: 15px;">
        <button type="submit" class="primary-button">Save</button>
      </div>
    </form>


    <table id="tabla-tareas" class="task-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Frequency</th>
          <th>Time</th>
          <th>Interval</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

  </div>


</html>